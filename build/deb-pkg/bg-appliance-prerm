#!/bin/sh -e
#
# COPYRIGHT 2017 Brightgate Inc.  All rights reserved.
#
# This copyright notice is Copyright Management Information under 17 USC 1202
# and is included to protect this work and deter copyright infringement.
# Removal or alteration of this Copyright Management Information without the
# express written permission of Brightgate Inc is prohibited, and any
# such unauthorized removal or alteration will be a violation of federal law.
#


# Brightgate packaging policy: set -x required.
set -x

if [ "x$1" = "xremove" ]; then
    # Disable appliance services.
    systemctl stop brightgate-appliance.service
    systemctl stop ap.mcp.service

    systemctl disable brightgate-appliance.service
    systemctl disable ap.mcp.service

    # Remove the modifications we made to the dhcpcd config
    sed -i "/^# Brightgate Options Start/,/^# Brightgate Options End/d" /etc/dhcpcd.conf

    # Enable the services we normally disable.
    systemctl enable avahi-daemon.service
    systemctl enable dnsmasq.service

elif [ "x$1" = "xupgrade" ]; then

    # Remove the modifications we made to the dhcpcd config
    sed -i "/Brightgate option/d" /etc/dhcpcd.conf

fi

# Otherwise we are upgrading to $1, and we will leave the services undisturbed.
exit 0
