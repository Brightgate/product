#!/bin/sh -e
#
# COPYRIGHT 2017 Brightgate Inc.  All rights reserved.
#
# This copyright notice is Copyright Management Information under 17 USC 1202
# and is included to protect this work and deter copyright infringement.
# Removal or alteration of this Copyright Management Information without the
# express written permission of Brightgate Inc is prohibited, and any
# such unauthorized removal or alteration will be a violation of federal law.
#

# Brightgate packaging policy: set -x required.
set -x

if [ "x$1" = "xconfigure" ]; then
    # Disable services that collide with our use, or that we want to manage
    # directly.
    systemctl disable avahi-daemon.service
    systemctl disable dnsmasq.service

    # Prevent linux from acting like a wlan client
    # Ask the upstream DHCP server to identify itself
    cat >> /etc/dhcpcd.conf << EOF
allowinterfaces eth* enx*                                   # Brightgate option
denyinterfaces eth*.* enx*.*                                # Brightgate option
option vendor_class_identifier, vendor_encapsulated_options # Brightgate option
EOF

    # Enable appliance services.
    systemctl enable ap.mcp.service
    systemctl enable brightgate-appliance.service

    systemctl start ap.mcp.service
    systemctl start brightgate-appliance.service
fi

# Some other abort action was received.
exit 0
