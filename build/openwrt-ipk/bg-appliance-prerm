#!/bin/ash -e
#
# COPYRIGHT 2019 Brightgate Inc.  All rights reserved.
#
# This copyright notice is Copyright Management Information under 17 USC 1202
# and is included to protect this work and deter copyright infringement.
# Removal or alteration of this Copyright Management Information without the
# express written permission of Brightgate Inc is prohibited, and any
# such unauthorized removal or alteration will be a violation of federal law.
#

# Brightgate packaging policy: set -x required.
set -x

# PKG_UPGRADE=0 indicates an install or remove.

line_remove () {
	# $1 - file
	# $2 - sed command
	sed -i -e "$2" "$1"
}

# Remove sourcing of com-brightgate-profile.
line_remove "$PKG_ROOT/root/.profile" "/. \/opt\/com.brightgate\/etc\/com-brightgate-profile/ d"

# Drop /etc/rsyslog.d from /etc/rsyslog.conf.
line_remove "$PKG_ROOT/etc/rsyslog.conf" "/\\\$IncludeConfig \/etc\/rsyslog.d\/@ d"

if [ "$PKG_ROOT" = "/" ]; then
	# Restart rsyslog.
	/etc/rc.common /etc/init.d/rsyslog restart

	# Deactivate Brightgate services.
	/etc/rc.common /etc/init.d/brightgate-appliance stop
	/etc/rc.common /etc/init.d/ap.mcp stop

	/etc/rc.common /etc/init.d/brightgate-appliance disable
	/etc/rc.common /etc/init.d/ap.mcp disable
fi
