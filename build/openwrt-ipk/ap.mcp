#!/bin/sh /etc/rc.common
#
# COPYRIGHT 2018 Brightgate Inc.  All rights reserved.
#
# This copyright notice is Copyright Management Information under 17 USC 1202
# and is included to protect this work and deter copyright infringement.
# Removal or alteration of this Copyright Management Information without the
# express written permission of Brightgate Inc is prohibited, and any
# such unauthorized removal or alteration will be a violation of federal law.
#

START=60
STOP=70

USE_PROCD=1
PROG=/opt/com.brightgate/bin/ap.mcp

IDDIR=/opt/etc
IDFILE=${IDDIR}/machine-id

start_service()
{
	if [ ! -d ${IDDIR} ]; then
		mkdir -p ${IDDIR}
	fi

	if [ ! -f ${IDFILE} ]; then
		MACHINE_ID=$(/usr/bin/uuidgen)
		OPTS="-nodeid $MACHINE_ID"
	fi

	procd_open_instance
	procd_set_param env LD_LIBRARY_PATH=/opt/lib
	procd_set_param stdout 1
	procd_set_param stderr 1
	procd_set_param command ${PROG} -root /opt/com.brightgate -l //var/log/mcp.log ${OPTS}
	procd_set_param respawn
	procd_close_instance
}
